#!/bin/bash
# simple volume notification script
#
pid="1283"
iconpath="/usr/share/icons/buuf-icons-for-plasma/32x32/status/"
vol_high="audio-volume-high"
vol_med="audio-volume-medium"
vol_low="audio-volume-low"
nothead="Volume:"
time=3000
incr=10

geticon(){
    if (( $vol > 66 ))
        then
	    icon=$vol_high
	    	else
	    	    if (( $vol < 33  ))
	        then icon=$vol_low
		    else
			icon=$vol_med
		    fi
    fi
}

get_status(){
	STAT=$(pulsemixer -l | grep "Sink" | awk '{print $10}' | sed  's/,//')
}

mute(){
    if [ $STAT == 0 ] ;
	then
            icon="audio-volume-muted"
	    text="muted"
	    pulsemixer --mute
        else
	   vol=$(pulsemixer --get-volume --id sink-0 | awk '{print $1}')
	   geticon
	   text="$vol"%
	   pulsemixer --unmute
    fi
}

up(){
    if [ $STAT == 0 ] ;
	then
	    vol=$(pulsemixer --get-volume --id sink-0 | awk '{print $1}')
	    ost=$((100 - $vol))
	        if (($ost < $incr )) ;
	            then
		        geticon
		        pulsemixer --set-volume 100
	                vol=100
		    else
		        pulsemixer --change-volume +$incr
	                vol=$(pulsemixer --get-volume --id sink-0 | awk '{print $1}')
			geticon
		fi
    	    text="$vol"%
        else
	    icon="audio-volume-muted"
	    text="muted"
    fi
}

down(){
if [ $STAT == 0 ] ;
    then
        vol=$(pulsemixer --get-volume --id sink-0 | awk '{print $1}')
            if (($vol < $incr )) ;
                then
      	            geticon
		    pulsemixer --set-volume 0
	            vol=0
		else
		    pulsemixer --change-volume -$incr
	            vol=$(pulsemixer --get-volume --id sink-0 | awk '{print $1}')
		    geticon
	    fi
    	text="$vol"%
    else
	geticon
	text="muted"
    fi
}

get_status

case  $1 in
	mute) mute ;;
	up) up ;;
	down) down;;

esac

dunstify -i $iconpath$icon.png  -t $time -r $pid $nothead $text

